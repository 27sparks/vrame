<% if !defined?(level) then level = 0 end %>

<% if defined?(category) and category %>
	<%= render :partial => 'document', :collection => category.documents, :locals => { :level => level } %>
	<% categories = category.children %>
<% end %>

<% sublevel = level + 1 %>
<% for category in categories do %>
	<%= render :partial => 'category', :object => category, :locals => { :level => level } %>
	<%= render :partial => 'document', :collection => category.documents, :locals => { :level => sublevel } %>
	<%= render :partial => 'category_tree', :locals => { :categories => category.children, :level => sublevel } %>
<% end %>